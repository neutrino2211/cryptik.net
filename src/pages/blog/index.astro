---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header";
import Footer from "../../components/Footer";

const allPosts = await getCollection("blog");
const sortedPosts = allPosts.sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

function formatDate(date: Date) {
    return new Date(date).toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
    });
}
---

<Layout
    title="Blog - Cryptik"
    description="Security insights, tutorials, and industry analysis from Cryptik's expert team."
>
    <Header client:load />

    <main class="min-h-screen pt-28 pb-20 bg-cryptik-dark">
        <div class="max-w-7xl mx-auto px-6">
            <!-- Page Header -->
            <div class="mb-16">
                <h1 class="text-5xl md:text-6xl font-bold mb-6 leading-tight">
                    Security <span class="text-cryptik-green">Insights</span>
                </h1>
                <p class="text-xl text-gray-400 max-w-3xl">
                    Expert analysis, tutorials, and research from Nigeria's
                    leading cybersecurity team.
                </p>
            </div>

            <!-- Blog Posts Grid -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                {
                    sortedPosts.map((post) => (
                        <article class="group bg-cryptik-gray/50 border-2 border-white/10 rounded-sm brutal-shadow hover:translate-x-1 hover:translate-y-1 hover:shadow-none hover:border-cryptik-green transition-all">
                            <a href={`/blog/${post.slug}`} class="block">
                                {/* Post Content */}
                                <div class="p-6">
                                    {/* Date & Author */}
                                    <div class="flex items-center gap-2 text-sm text-gray-400 mb-4">
                                        <time
                                            datetime={post.data.pubDate.toISOString()}
                                        >
                                            {formatDate(post.data.pubDate)}
                                        </time>
                                        <span>â€¢</span>
                                        <span>{post.data.author}</span>
                                    </div>

                                    {/* Title */}
                                    <h2 class="text-2xl font-bold mb-3 group-hover:text-cryptik-green transition-colors">
                                        {post.data.title}
                                    </h2>

                                    {/* Description */}
                                    <p class="text-gray-400 mb-6 line-clamp-3">
                                        {post.data.description}
                                    </p>

                                    {/* Tags */}
                                    <div class="flex flex-wrap gap-2">
                                        {post.data.tags.map((tag) => (
                                            <span class="text-xs bg-cryptik-green/20 text-cryptik-green px-3 py-1 rounded-sm border border-cryptik-green/30">
                                                {tag}
                                            </span>
                                        ))}
                                    </div>
                                </div>

                                {/* Read More Link */}
                                <div class="px-6 pb-6">
                                    <span class="text-cryptik-green font-semibold flex items-center gap-2 group-hover:gap-4 transition-all">
                                        Read Article
                                        <svg
                                            class="w-4 h-4"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M9 5l7 7-7 7"
                                            />
                                        </svg>
                                    </span>
                                </div>
                            </a>
                        </article>
                    ))
                }
            </div>
        </div>
    </main>

    <Footer client:load />
</Layout>

<style>
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
